@model ListaViewModel
@{
    ViewData["Title"] = "Lista";
} 

<div class="container-fluid">
    <h4 class="page-title" style="display:flex; align-items:center;"><button class="btn">&#127968;</button>Campanhas >> Listas</h4>
    
    <div class="templateDiv">

        <div class="coluna-titulos">
            <div class="titulo-coluna">Nome</div>
            <div class="titulo-coluna">Data</div>
            <div class="titulo-coluna">Status</div>


            <form asp-controller="LoadCSV" asp-action="NovaLinha" method="post" enctype="multipart/form-data">
                <button id="btnNew" type="submit"><i class="fas fa-plus" style="color:green;margin-right:6%;"></i>  Nova</button>
            </form>



        </div>
        
        @if(Model!=null)
        {
            int indice = (Model.PaginaCounter * 6);

            @for (int i = indice - 6; i < indice && i < Model.LinhaLista.Count; i++)
            {
                string backgroundColor = (i % 2 == 0) ? "lightgray" : "white";

                string nameField = (Model.LinhaLista.Count > i) ? Model.LinhaLista[i].Nome : "Nome";
                DateTime dateField = (Model.LinhaLista.Count > i) ? Model.LinhaLista[i].Data : DateTime.Now;
                string statusField = (Model.LinhaLista.Count > i) ? Model.LinhaLista[i].Status : "Sem arquivo";

                <div class="coluna" style="background-color:@backgroundColor;">
                    <div>@nameField</div>
                    <div>@dateField</div>
                    <div>@statusField</div>

                    <form asp-controller="LoadCSV" asp-action="AtualizaLinha" method="post" enctype="multipart/form-data">
                        <label class="custom-file-upload">
                            <input type="file" name="file" accept=".csv" id="file" style="display:none" required />
                            Carregar CSV
                        </label>

                        <input type="hidden" name="linhaId" value="@i" />
                        <button type="submit" class="btn-deletar"><i class="fas fa-play" style="color:green"></i></button>
                    </form>


                    <button class="btn-deletar"><i class="fas fa-pause" style="color:red"></i></button>
                    <form asp-controller="LoadCSV" asp-action="DeletaLinha" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="index" value="@i" />
                        <button type="submit" class="btn-deletar"><i class="fas fa-trash" style="color:red"></i></button>
                    </form>

                    <button class="btn expand-button" data-target="#extraContent-@i"><i class="fa-solid fa-chevron-down"></i></button>

                </div>

                <div id="extraContent-@i" class="extra-content">
                    <div colspan="4">
                        <div class="progress progress-striped">
                            <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                        </div>

                    </div>
                </div>


            }
            <div class="pagina-info">
                Mostrando @((6*Model.PaginaCounter) -5) a @((6*Model.PaginaCounter)) de @Model.LinhaLista.Count resultados
            </div>

            <!-- Botões de navegação de página -->
            <div class="paginacao">
                @{
                    int firstPage=0;

                    if(Model.PaginaCounter>=3)
                        firstPage = Model.PaginaCounter - 2;
                    else
                        firstPage = 1;



                    @for (int i = firstPage; i <= Model.MaxPaginaCounter && i <= firstPage + 4; i++)
                    {
                        var btnClass = (i == Model.PaginaCounter) ? "btn-pagina btn-pagina-selecionada" : "btn-pagina";
                        <form asp-controller="LoadCSV" asp-action="TrocaPagina" method="post" enctype="multipart/form-data">
                            <input type="hidden" name="index" value="@i" />
                            <button class="@btnClass">@i</button>
                        </form>
                    }

                }
            </div>
        }
        else
        {
            <div class="pagina-info">
                Mostrando 0 resultados
            </div>
            <!-- Botões de navegação de página -->
            <div class="paginacao">

                    <button type="submit" class="btn-pagina">1</button>
               
            </div>
        }





    </div>
</div>



@section Scripts
{
    <script>
        $(document).ready(function () {
            $(".expand-button").click(function () {
                // Identificar a barra de progresso associada ao botão clicado
                var target = $(this).data("target");

                // Verificar se a barra de progresso associada está atualmente visível
                var isVisible = $(target).is(":visible");

                // Ocultar todas as barras de progresso
                $(".extra-content").hide();

                // Se a barra de progresso associada estava oculta, mostrá-la
                if (!isVisible) {
                    $(target).show();
                }
            });
        });


    </script>
}

